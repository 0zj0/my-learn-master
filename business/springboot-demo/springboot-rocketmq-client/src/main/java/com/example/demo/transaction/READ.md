![Image text](https://note.youdao.com/yws/public/resource/85f1414331663a6dea343aa7bf74fd3f/xmlnote/FA34552B77DA4FEFBE557621F19F11A6/6830)
事务消息发送步骤如下：
1、发送方将半事务消息发送至消息队列 MQ 服务端，存放在中转队列中。
2、消息队列 MQ 服务端将消息持久化成功之后，向发送方返回 Ack 确认消息已经发送成功，此时消息为半事务消息。
3、发送方开始执行本地事务逻辑。
4、发送方根据本地事务执行结果向服务端提交二次确认（Commit 或是 Rollback），服务端收到 Commit 状态则将半事务消息标记为可投递，
订阅方最终将收到该消息；服务端收到Rollback 状态则删除半事务消息，订阅方将不会接受该消息。

事务消息回查步骤如下：
1、在断网或者是应用重启或者长事务的特殊情况下，上述步骤 4 提交的二次确认最终未到达服务端，经过固定时间后服务端将对该消息发起消息回查。
2、发送方收到消息回查后，需要检查对应消息的本地事务执行的最终结果。
3、发送方根据检查得到的本地事务的最终状态再次提交二次确认，服务端仍按照步骤 4对半事务消息进行操作。
